#include <iostream>
#include <Windows.h>
#include <string>
#include <thread>
#include <vector>

#include "Execution.hpp"


void main()
{
	std::thread(Bypass::bypass_thread).detach();
	Hooks::messagebox_hook();

	exthread = (uintptr_t)lua_newthread((lua_State*)LuaState::get_robloxstate());
	Lua::setlevel(exthread, 8);
	luaL_sandboxthread((lua_State*)exthread);

	MAP_INT3();
	AddVectoredExceptionHandler(1, VEH);

	API::registration(exthread);

	Execution::run_script(exthread, "print('nezy-skid loaded!')");
	Addresses::r_lua_print(3, "skidded");

	std::thread(Execution::pipe).detach();
}


int __stdcall DllMain(void* Module, DWORD Reason, void* Reserve)
{
	if (Reason == 1)
	{
		std::thread(main).detach();
	}
	return true;
}